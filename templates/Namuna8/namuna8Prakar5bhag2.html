<!DOCTYPE html>
<html >
  <head>
    <meta charset="UTF-8" />
    <title>नमुना ८</title>
    <style>
      body {
        font-family: "Mangal", Arial, sans-serif;
      }
      table {
        border-collapse: collapse;
        width: 100%;
        font-size: 13px;
      }
      .header-table td {
        border: none;
        padding: 2px 4px;
      }
      .center {
        text-align: center;
      }
      .left {
        text-align: left;
      }
      .right {
        text-align: right;
      }
      .bold {
        font-weight: bold;
      }
      th,
      td {
        border: 1px solid #000;
        padding: 2px 4px;
        text-align: center;
        vertical-align: middle;
      }
      th {
        background: #f0f0f0;
      }
      .footer-summary {
        border: 3px solid #000;
        border-top: none;
        font-size: 13px;
        font-weight: bold;
        margin-top: 0;
        margin-bottom: 0;
        padding: 2px 8px;
        display: inline-block;
        background: #fff;
      }
      tr {
        page-break-inside: avoid;
        break-inside: avoid;
      }
      thead {
        display: table-header-group;
      }
      tfoot {
        display: table-footer-group;
      }
      .nested-table {
        width: 100%;
        height: 100%;
        border-collapse: collapse;
        table-layout: fixed;
      }
      .nested-table tr,
      .nested-table td {
        height: 100%;
        vertical-align: stretch;
        padding: 0;
        text-align: center;
        word-break: break-word;
      }
      @media print {
        @page {
          size: A4 landscape;
        }
        #toolbar {
          display: none !important;
        }
        /* Ensure footer appears at the end during print */
        .footer-summary {
          display: table !important;
          page-break-inside: avoid;
          break-inside: avoid;
          page-break-before: avoid;
          break-before: avoid;
        }
        /* Keep footer with the last page content */
        #mainContent {
          page-break-after: avoid;
          break-after: avoid;
        }
      }
    </style>
  </head>
  <body>
    <div
      id="toolbar"
      style="
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 6px 12px;
        background: #f8f8f8;
        border-bottom: 1px solid #ccc;
      "
    >
      <!-- Left: Icon Buttons & Navigation -->
      <div style="display: flex; align-items: center; gap: 6px">
        <button
          title="First Page"
          style="
            background: none;
            border: none;
            font-size: 16px;
            cursor: pointer;
          "
        >
          ⏮️
        </button>
        <button
          title="Previous Page"
          style="
            background: none;
            border: none;
            font-size: 16px;
            cursor: pointer;
          "
        >
          ◀️
        </button>
        <input
          type="text"
          value="1"
          id="pageInput"
          style="
            width: 32px;
            text-align: center;
            font-size: 14px;
            border: 1px solid #ccc;
            border-radius: 2px;
            margin: 0 2px;
          "
        />
        <span id="pageTotal" style="font-size: 14px; color: #888"></span>
        <button
          title="Next Page"
          style="
            background: none;
            border: none;
            font-size: 16px;
            cursor: pointer;
          "
        >
          ▶️
        </button>
        <button
          title="Last Page"
          style="
            background: none;
            border: none;
            font-size: 16px;
            cursor: pointer;
          "
        >
          ⏭️
        </button>
        <button
          title="Zoom Out"
          onclick="zoomOut()"
          style="
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
          "
        >
          ➖
        </button>
        <span
          id="zoomPercent"
          style="min-width: 40px; text-align: center; font-size: 14px"
          >100%</span
        >
        <button
          title="Zoom In"
          onclick="zoomIn()"
          style="
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
          "
        >
          ➕
        </button>
      </div>
      <!-- Right: Print & Exit Buttons -->
      <div style="display: flex; align-items: center; gap: 8px">
        <button
          onclick="printPage()"
          style="
            background: #4caf50;
            color: #fff;
            font-weight: bold;
            font-size: 20px;
            border: none;
            border-radius: 20px;
            padding: 2px 24px;
            cursor: pointer;
          "
        >
          Print
        </button>
        <button
          onclick="exitPage()"
          style="
            background: #b71c1c;
            color: #fff;
            font-weight: bold;
            font-size: 20px;
            border: none;
            border-radius: 20px;
            padding: 2px 24px;
            cursor: pointer;
          "
        >
          EXIT
        </button>
      </div>
    </div>
    <script>
      let zoomLevel = 1.0;
      const minZoom = 0.5;
      const maxZoom = 2.0;
      const zoomStep = 0.1;
      let currentPage = 1;
      const recordsPerPage = 2; // 2 tables (records) per page
      let totalPages = 0;

      function updateZoom() {
        document.getElementById("mainContent").style.zoom = zoomLevel;
        document.getElementById("zoomPercent").innerText =
          Math.round(zoomLevel * 100) + "%";
      }
      function zoomIn() {
        if (zoomLevel < maxZoom) {
          zoomLevel += zoomStep;
          zoomLevel = Math.min(maxZoom, zoomLevel);
          updateZoom();
        }
      }
      function zoomOut() {
        if (zoomLevel > minZoom) {
          zoomLevel -= zoomStep;
          zoomLevel = Math.max(minZoom, zoomLevel);
          updateZoom();
        }
      }
      function updateFooterSummary() {
          // Calculate totals for all records (not just visible ones)
          const allRows = Array.from(document.querySelectorAll('.record-row'));
          let house = 0, lighting = 0, health = 0, water = 0, cleaning = 0, toilet = 0, total = 0;
          allRows.forEach(row => {
              house += parseFloat(row.dataset.houseTax) || 0;
              lighting += parseFloat(row.dataset.lightingTax) || 0;
              health += parseFloat(row.dataset.healthTax) || 0;
              water += parseFloat(row.dataset.waterTax) || 0;
              cleaning += parseFloat(row.dataset.cleaningTax) || 0;
              toilet += parseFloat(row.dataset.toiletTax) || 0;
              total += parseFloat(row.dataset.totalTax) || 0;
          });
          if(document.getElementById('footerHouseTax'))
              document.getElementById('footerHouseTax').innerText = `घर : ${house.toFixed(2)}`;
          if(document.getElementById('footerLightingTax'))
              document.getElementById('footerLightingTax').innerText = `दिवा : ${lighting.toFixed(2)}`;
          if(document.getElementById('footerHealthTax'))
              document.getElementById('footerHealthTax').innerText = `आरोग्य : ${health.toFixed(2)}`;
          if(document.getElementById('footerWaterTax'))
              document.getElementById('footerWaterTax').innerText = `पाणी : ${water.toFixed(2)}`;
          if(document.getElementById('footerCleaningTax'))
              document.getElementById('footerCleaningTax').innerText = `सफाई : ${cleaning.toFixed(2)}`;
          if(document.getElementById('footerToiletTax'))
              document.getElementById('footerToiletTax').innerText = `शौ. कर : ${toilet.toFixed(2)}`;
          if(document.getElementById('footerTotalTax'))
              document.getElementById('footerTotalTax').innerText = `एकूण : ${total.toFixed(2)}`;
      }
      function showPage(page) {
        const recordPages = Array.from(
          document.querySelectorAll(".record-page")
        );
        totalPages = Math.ceil(recordPages.length);
        if (page < 1) page = 1;
        if (page > totalPages) page = totalPages;
        currentPage = page;
        recordPages.forEach((el, idx) => {
          el.style.display = idx + 1 === currentPage ? "" : "none";
        });
        document.getElementById("pageInput").value = currentPage;
        if (document.getElementById("pageTotal"))
          document.getElementById("pageTotal").innerText = "/" + totalPages;
        updateFooterSummary(); // <-- Add this line
        const footerElement = document.getElementById('footerSummary');
            if (currentPage === totalPages) {
                footerElement.style.display = 'block';
            } else {
                footerElement.style.display = 'none';
            }
      }
      function nextPage() {
        showPage(currentPage + 1);
      }
      function prevPage() {
        showPage(currentPage - 1);
      }
      function firstPage() {
        showPage(1);
      }
      function lastPage() {
        showPage(totalPages);
      }
      function printPage() {
        // Show all pages before printing, then restore current page
        const recordPages = Array.from(
          document.querySelectorAll(".record-page")
        );
        const prevStates = recordPages.map((el) => el.style.display);
        recordPages.forEach((el) => (el.style.display = ""));
        setTimeout(() => {
          window.print();
          setTimeout(() => {
            recordPages.forEach((el, idx) => {
              el.style.display = idx + 1 === currentPage ? "" : "none";
            });
          }, 100);
        }, 50);
      }
      function exitPage() {
        window.close();
      }
      window.onload = function () {
        updateZoom();
        showPage(1);
        updateFooterSummary(); // <-- Add this line
        // Wire up navigation buttons
        document.querySelector('button[title="First Page"]').onclick =
          firstPage;
        document.querySelector('button[title="Previous Page"]').onclick =
          prevPage;
        document.querySelector('button[title="Next Page"]').onclick = nextPage;
        document.querySelector('button[title="Last Page"]').onclick = lastPage;
      };
    </script>
    <div id="mainContent">
      {% set num_records = data|length %}
      {% set num_pages = (num_records // 2) + (1 if num_records % 2 else 0) %}
      {% for page in range(num_pages) %}
        <!-- Header Section: Place this at the top of your HTML file -->
        <div class="record-page" style="page-break-after: always">
          <!-- Info block: appears once per page -->
          <div class="report-header">
            {% if tip %}
            <div
              class="report-warning"
              style="
                color: red;
                text-align: center;
                font-weight: bold;
                font-size: 14px;
              "
            >
            (टीप: सदरचा उत्तारा हा मालकी हक्काचा नसून कर आकारणी साठी आहे. सदरच्या उताऱ्यावरून खरेदी विक्रीचा व्यवहार झाल्यास  त्यास ग्रामपंचायत जबाबदार राहणार नाही. शासन परिपत्रक क्र.पं.रा.स.2016 पं.क्र.17 पं.रा-4 तारीख 18 जुलै 2016.) <br>
            (*टीप:* शासन परिपत्रक क. VTM२६०३/प्र.क्र.२०६८/पं.रा.४ दि २० नोव्हेंबर २००३ नुसार ग्रामीण भागातील घरांची नोंदणी पती-पत्नी यांच्या संयुक्त नावे करण्यात आलेले आहे.)
            </div>
            {% else %}
            <div
              class="report-warning"
              style="
                color: red;
                text-align: center;
                font-weight: bold;
                font-size: 14px;
              "
            >
            </div>
            {% endif %}
            <div
              class="report-info"
              style="
                display: flex;
                justify-content: space-between;
                margin-top: 10px;
                font-size: 14px;
                flex-wrap: wrap;
              "
            >
              <span>ग्राम पंचायत : {{ gramPanchayat | default('') }} </span>
              <span> गाव/ मोहल्ला : {{ village | default('') }} </span>
              <span style="color: green; font-weight: bold; font-size: 16px"
                >नमुना 8</span
              >
              <span>नियम 32 ( 1 ) </span>
              <span> तालुका: {{ taluka | default('') }} </span>
              <span> जिल्हा : {{ jilha | default('') }} </span>
            </div>
            <div
              class="fontSizeData"
              style="margin-top: 5px; font-size: 12px; text-align: center"
            >
              <span>सन {{ yearFrom | default('') }} ते {{ yearTo | default('') }} </span>
              <span style="padding-left: 100px"
                >या वर्षासाठी कर आकारणी नोंदवही</span
              >
            </div>
          </div>

          <style>
            table th,
            table td {
              padding: 2px 4px !important;
              border: 1px solid #000 !important;
            }
          </style>

          {% for i in range(2) %}
            {% set idx = page * 2 + i %}
            {% if idx < num_records %}
              {% set row = data[idx] %}
              <div style="margin-bottom: 16px">
                <table
                  style="
                    text-align: center;
                    width: 100%;
                    border-collapse: collapse;
                    border: 1px solid #000;
                    font-size: 14px;
                    margin-top: 0;
                  "
                >
                  <tr>
                    <th rowspan="2">भांडवली मुल्य (रुपये)</th>
                    <th rowspan="2">कराचे दर (पैसे)</th>
                    <th colspan="5">कराची रक्कम (रुपये)</th>
                    <th colspan="5">
                      अपिलाचे निकाल आणि त्यानंतर केलेले फेरफार (रुपये)
                    </th>
                    <th rowspan="2" colspan="2">
                      नंतर वाढ किंवा घट आलेल्या बांधकामाचे अंदाजित क्षेत्र
                    </th>
                  </tr>
                  <tr>
                    <th>घरपट्टी</th>
                    <th>दिवाबत्ती</th>
                    <th>आरोग्यकर</th>
                    <th>पाणीपट्टी</th>
                    <th>एकूण</th>
                    <th>घरपट्टी</th>
                    <th>दिवाबत्ती</th>
                    <th>आरोग्यकर</th>
                    <th>पाणीपट्टी</th>
                    <th>एकूण</th>
                  </tr>
                  <tr style="text-align: center; font-weight: 700">
                    <td>1</td>
                    <td>2</td>
                    <td>3</td>
                    <td>4</td>
                    <td>5</td>
                    <td>6</td>
                    <td>7</td>
                    <td>8</td>
                    <td>9</td>
                    <td>10</td>
                    <td>11</td>
                    <td>12</td>
                    <td colspan="2">13</td>
                  </tr>
                  <tr class="record-row"
                      data-house-tax="{{ row.totalHouseTax | default('0') }}"
                      data-lighting-tax="{{ row.lightingTax | default('0') }}"
                      data-health-tax="{{ row.healthTax | default('0') }}"
                      data-water-tax="{{ (row.sapanikar if row.sapanikar is defined else row.waterTax) | default('0') }}"
                      data-cleaning-tax="{{ row.cleaningTax | default('0') }}"
                      data-toilet-tax="{{ row.toiletTax | default('0') }}"
                      data-total-tax="{{ (row.totaltax|default(0)|float - (row.vpanikar|default(0)|float)) }}">
                    <td>
                      {% if row.constructionType is defined and row.constructionType|length > 0 %}
                          {{ row.constructionType[0].capitalValue | default('') }}<br>
                      {% endif %}
                      {% if row.constructionType is defined and row.constructionType|length > 1 %}
                          {{ row.constructionType[1].capitalValue | default('') }}<br>
                      {% endif %}
                      {% if row.khaliJaga is defined and row.khaliJaga|length > 0 %}
                          {{ row.khaliJaga[0].capitalValue | default('') }}
                      {% endif %}
                      <hr></hr>
                      {{row.totalCapitalValue}}
                  </td>
                  <td>
                    {% if row.constructionType is defined and row.constructionType|length > 0 %}
                        {{ row.constructionType[0].depreciation_rate | default('') }}<br>
                    {% endif %}
                    {% if row.constructionType is defined and row.constructionType|length > 1 %}
                        {{ row.constructionType[1].depreciation_rate | default('') }}<br>
                    {% endif %}
                    0
                </td>
                <td>
                  {% if row.constructionType is defined and row.constructionType|length > 0 %}
                      {{ row.constructionType[0].houseTax | default('') }}<br>
                  {% endif %}
                  {% if row.constructionType is defined and row.constructionType|length > 1 %}
                      {{ row.constructionType[1].houseTax | default('') }}<br>
                  {% endif %}
                  {% if row.khaliJaga is defined and row.khaliJaga|length > 0 %}
                      {{ row.khaliJaga[0].houseTax | default('') }}
                  {% endif %}
                  <hr></hr>
                  {{row.totalHouseTax}}
              </td>
                    <td>{{ row.lightingTax | default('') }}</td>
                    <td>{{ row.healthTax | default('') }}</td>
                    <td>{{ (row.sapanikar if row.sapanikar is defined else row.waterTax) | default('') }}</td>
                    <td> {{ (row.totaltax|default(0)|float - (row.vpanikar|default(0)|float)) }} </td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                  </tr>
                </table>

                <!-- Seprate this two table by some space -->
                <table
                  style="
                    text-align: center;
                    width: 100%;
                    border-collapse: collapse;
                    border: 1px solid #000;
                    font-size: 14px;
                    margin-top: 0;
                  "
                >
                  <tr>
                    <td
                      style="
                        width: 60%;
                        text-align: left;
                        border-right: 1px solid #000;
                      "
                    >
                      शेरा : {{ row.remarks | default('') }}
                    </td>
                    <td style="text-align: left">शौचालय : {{ row.toilet | default('') }}</td>
                    <td style="text-align: left; border-right: 1px solid #000">
                      चतुर्सिमा
                    </td>
                    <td style="text-align: left; border-right: 1px solid #000">
                      पूर्व : {{ row.boundaryEast | default('') }}
                    </td>
                    <td style="text-align: left; border-right: 1px solid #000">
                      पश्चिम : {{ row.boundaryWest | default('') }}
                    </td>
                    <td style="text-align: left; border-right: 1px solid #000">
                      उत्तर : {{ row.boundaryNorth | default('') }}
                    </td>
                    <td style="text-align: left; border-right: 1px solid #000">
                      दक्षिण : {{ row.boundarySouth | default('') }}
                    </td>
                  </tr>
                </table>
              </div>
            {% endif %}
          {% endfor %}
          <style>
            @media print {
              @page {
                size: A4 landscape;
                margin: 6mm;
              }
              html,
              body {
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 0;
                overflow: visible;
                font-size: 11px;
              }
              .report-header,
              .report-footer,
              .report-info,
              .fontSizeData,
              .report-warning,
              table {
                page-break-inside: avoid !important;
                break-inside: avoid !important;
              }
              /* Ensure footer stays with the last page */
              .footer-summary {
                page-break-before: avoid !important;
                break-before: avoid !important;
                page-break-inside: avoid !important;
                break-inside: avoid !important;
              }
              #mainContent {
                page-break-after: avoid !important;
                break-after: avoid !important;
              }
              table {
                font-size: 10px !important;
              }
              table th,
              table td {
                padding: 1px 2px !important;
              }
              .report-header,
              .report-info,
              .fontSizeData,
              .report-warning {
                font-size: 11px !important;
              }
              .report-header span[style*="font-size: 16px"] {
                font-size: 12px !important;
              }
              /* Remove forced page breaks */
              .page-break,
              br[style*="page-break"] {
                display: none !important;
              }
              /* Remove extra margins/paddings from body */
              body {
                margin: 0;
                padding: 0;
                max-width: 100vw;
                max-height: 100vh;
              }
              /* Remove extra vertical space */
              div[style*="height: 20px"] {
                display: none !important;
              }
            }
          </style>
        </div>
      {% endfor %}
    </div>

    <!-- Footer Summary - Outside main content to avoid repetition -->
    <table class="footer-summary" id="footerSummary" style="width: 100%; border-collapse: collapse; border: 2px solid #000; font-size: 14px; margin-top: 20px;">
        <tr>
          <td style="border: 1px solid #000; text-align: left; width: 15%;">एकूण कर :</td>
          <td id="footerHouseTax" style="border: 1px solid #000; text-align: left; width: 10%;"></td>
          <td id="footerLightingTax" style="border: 1px solid #000; text-align: left; width: 10%;"></td>
          <td id="footerHealthTax" style="border: 1px solid #000; text-align: left; width: 10%;"></td>
          <td id="footerWaterTax" style="border: 1px solid #000; text-align: left; width: 10%;"></td>
          <td id="footerCleaningTax" style="border: 1px solid #000; text-align: left; width: 10%;"></td>
          <td id="footerToiletTax" style="border: 1px solid #000; text-align: left; width: 10%;"></td>
          <td id="footerTotalTax" style="border: 1px solid #000; text-align: left; width: 10%;"></td>
        </tr>
    </table>
  </body>
</html>
